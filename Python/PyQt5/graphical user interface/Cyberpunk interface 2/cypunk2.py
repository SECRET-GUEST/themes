#         ████████     ██████
#        █░░░░░░░░██_██░░░░░░█
#       █░░░░░░░░░░░█░░░░░░░░░█
#      █░░░░░░░███░░░█░░░░░░░░░█
#      █░░░░███░░░███░█░░░████░█
#    █░░░██░░░░░░░░███░██░░░░██
#   █░░░░░░░░░░░░░░░░░█░░░░░░░░███
#   █░░░░░░░░░░░░░██████░░░░░████░░█
#   █░░░░░░░░░█████░░░████░░██░░██░░█
#  ██░░░░░░░███░░░░░░░░░░█░░░░░░░░███
# █░░░░░░░░░░░░░░█████████░░█████████
#█░░░░░░░░░░█████ ████   ████ █████ █
#█░░░░░░░░░░█      █ ███   █   ███ █ █
#█░░░░░░░░░░░░█   ████ ████    ██ ████
#░░░░░░░░░░░░░█████████░░░████████░░░█
#░░░░░░░░░░░░░░░░█░░░░░█░░░░░░░░░░░░█
#░░░░░░░░░░░░░░░░░░░░██░░░░█░░░░░░██
#░░░░░░░░░░░░░░░░░░██░░░░░░░███████
#░░░░░░░░░░░░░░░░██░░░░░░░░░░█░░░░░█                                            _____                                 _____                                            _____                                                   _____
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                          /\    \                               /\    \                                          /\    \                                                 /\    \
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                      ::                 /::\    \                             /::\    \                                        /::\____\                                               /::\____\
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                        /::::\    \                           /::::\    \           :::         ::           ::: ::/    /                         :                   :: ::/    /
#░░░░░░░░░░░█████████░░░░░░░░░░░░░░██                                       /::::::\    \                         /::::::\    \                               ::: : :::/    /                                              /:::/    /
#░░░░░░░░░░█▒▒▒▒▒▒▒▒███████████████▒▒█                                     /:::/\:::\    \                    :: ::::/\:::\    \                                  /:::/    /                                              /:::/    /
#░░░░░░░░░█▒▒███████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                    /:::/__\:::\    \                     /:::/__\:::\    \                                /:::/    /                                            :::: :/____/
#░░░░░░░░░█▒▒▒█▓▓▓▓██████████████████                                    /::::\   \:::\    \                   /::::\   \:::\    \                              /:::/    /                                              /::::\    \
#░░░░░░░░░██▒▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                       /::::::\   \:::\    \                 /::::::\   \:::\    \                            /:       /      _____                                   /::::::\    \   _____
#░░░░░░░░░░█▒▒█▓█████████████████ ████                                 /:::/\:::\   \:::\ ___\               /:::/\:::\   \:::\____\                          /:::/____/      /\    \                                 /:::/\:::\    \ /\    \
#░░░░░░░░░░█▒▒██▓▓▒▓▒▓▒▓▒▒▒▒▒▒▒▒▓█▓▒▒▒█                               /:::/__\:::\   \:::|    |             /:::/  \:::\   \:::|    |                         :::|    /      /::\____\                        ::::::: :::/ : :::\    /::\____\
#░░░░░░░░░█▒▒████████▓▒███▓██▒▒▒▒▒▒▒▒▒█                  :            \:::\   \:::\  /:::|____|             \::/   |::::\  /:::|____|                      : :: :|____\     /:::/    /                               \::/    \:::\: ::::/    /
#░░░░░░░░░█▒▒▒▒▒▒▒▒▒█████████████▓█▓██                                 \:::\   \:::\/:::/    /               \/____|:::::\/:::/    /                          \:::\    \   /:::/    /                                 \/____/: :::\/:::/    /
#░░░░░░░░░░████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                  \:::\   \::::::/    /                      |:::::::::/    /                            \:::\   :: : ::/    /                                 :  :  : : :::::::/    /
#░░░░░░░░░░░░░░░░░░██████████████████                                    \:::\   \::::/    /          :  :         |::|\::::/    /           ::                 \:::\    /:::/    /               ::::                          \::       /
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█            ::                           \:::\  /:::/    /                      :: ::| \::/____/                                \:::\__/:::/    /                                              /:::/    /
#██░░░░░░░░░░░░░░░░░░░░░░░░░░░██                                           \:::\/:::/    /                         |::|  ~|                                       \::::::::/    /                                             : :::/    /
#▓██░░░░░░░░░░░░░░░░░░░░░░░░██                                              \::::::/    /                          |::|   |                                        \::::::/    /                                              /:::/    /
#▓▓▓███░░░░░░░░░░░░░░░░░░░░█                                                 \::::/    /                           \::|   |                                         \::::/    /                              ::: :           /:::/    /
#▓▓▓▓▓▓███░░░░░░░░░░░░░░░██                                 :                 \::/____/            :                \:|   |               :    ::::                  \::/____/                                               \::/    /
#▓▓▓▓▓▓▓▓▓███████████████▓▓█                                                   ⠋                                     \|___|                                           ⠩                                                      \/____/
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                                                                                                                                                                                               |                                                                    |                                      |
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                    |                                                                                                             |
#______________________________                                                                                                                       |                                                                                                                      |                                                                                                                                              |                    |
#___________________________
#_ ______ _____ _________
#/            /                                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |
                
#       \                          |                                |                                               |  |                                          |                    |                                          |                       |                    |  |                                           |                    |        |                    |                              |
                

#     |               |                                 |
                
#                 |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#          |                                  |                                     |
                
#                 |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#  |                          |                       |                    |
#          |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                                                        |
#     |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |
                
#                     |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#          |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                |                                        |
                
#                 |                     |
#  |                                |                       |                    |            |                                |                       |                    |     |                                |                       |                    |     |                                |                       |                              |                                |
#          |                               |                                         |                              |                       |                    |                           |                       |                    |                           |                       |                    |                                |                       |                    |
                
#  |         |                                   PRESENTATION                                                |                                |                    |   |                                |                    |   |                                |                    |        |                                |                    |
#                                                                                                                              |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#               |                             /                 \                          |                                                                              |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
                
#       |                            A cyberpunk graphical interface for                    |                                           |               |                                           |               |                                           |                    |                                           |
                
#                          /                      |    v    |                    \
                
#               your app, you just have to import the class, you have an example of use downside      |                                |                                          |      |                                |                                          |      |                                |                                          |           |                                |  
#     |                  !      |                                   |     |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |
#                               |                                   |     |                  
#                  |            |                   Anyway          !                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |
                
#             |                      |                 have                                                 |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                                           |
                

#                |                                  FUN         |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                                                      |
                
#                                                        =)
                
#
#                               |                      or                                       |                                                            |                    |                |                       |                    |                |                       |                    |                    |                                           |
                

#             |                              |       DIE ! ! !        |                       |                            |                |                       |                    |                |                       |                    |                    |                                           |#     |                        |                                         |                                |
                
#
#                                                    !                                       |                                |                    |  |                                |                    |  |                                |                    |       |                                |                    |
                
#     |               |                                 !
                
#                 |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#          |                                  !                                     |
                
#                 |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#  |                          |                       |                    !
#          |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                    |                                    |
#     |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |
                
#                     |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#          |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                                                |
              
#_ _  _ ____ ___ ____ _    _    ____ ___ _ ____ _  _
#| |\ | [__   |  |__| |    |    |__|  |  | |  | |\ |
#| | \| ___]  |  |  | |___ |___ |  |  |  | |__| | \|
        

from PyQt5.QtWidgets import QMainWindow, QWidget, QPushButton, QFrame, QLabel, QMessageBox, QVBoxLayout, QSizeGrip,QRubberBand
from PyQt5.QtGui import QIcon, QPainterPath, QRegion, QPainter, QPainterPath, QPalette
from PyQt5.QtCore import Qt, QPoint, QSize,pyqtSignal

#___  ____ _ _ _ ____ ____    ___  _    ____ _  _ ___
#|__] |  | | | | |___ |__/    |__] |    |__| |\ |  |
#|    |__| |_|_| |___ |  \    |    |___ |  | | \|  |
                

#OPENING | https://www.youtube.com/watch?v=_85LaeTCtV8 :3



class SizeGrip(QRubberBand):
    def __init__(self, parent):
        super().__init__(QRubberBand.Rectangle, parent)
        self.setFixedSize(10, 10)
        self.setWindowFlags(Qt.SubWindow)
        self.setCursor(Qt.SizeFDiagCursor)

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.mousePos = event.globalPos()
            self.parentMousePos = self.parent().mapToGlobal(QPoint())
            event.accept()

    def mouseMoveEvent(self, event):
        if event.buttons() == Qt.LeftButton:
            diff = event.globalPos() - self.mousePos
            newWidth = max(self.parent().minimumWidth(), self.parent().width() + diff.x())
            newHeight = max(self.parent().minimumHeight(), self.parent().height() + diff.y())
            newSize = QSize(newWidth, newHeight)
            self.parent().resize(newSize)
            event.accept()





#_  _ ____ _  _ ____    ____ ___  ___     _ _ _ _ ___ _  _    ___ _ ___ _    ____ 
#|\/| |  | |  | |___    |__| |__] |__]    | | | |  |  |__|     |  |  |  |    |___ 
#|  | |__|  \/  |___    |  | |    |       |_|_| |  |  |  |     |  |  |  |___ |___ 
                                                                                 

class cypunkTitle1(QWidget):
    def __init__(self, parent):
        super().__init__(parent)

        self.setMouseTracking(True)  # enable tracking of mouse movements
        self.mouse_pressed = False  # initialize flag to check if mouse button is pressed
        self.mouse_position = QPoint()  # initialize mouse position variable

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:  # check if left mouse button is pressed
            self.mouse_pressed = True  # set flag to indicate left button is pressed
            self.mouse_position = event.globalPos() - self.parent().pos()  # calculate mouse position relative to parent widget
            event.accept()

    def mouseReleaseEvent(self, event):
        if event.button() == Qt.LeftButton:  # check if left mouse button is released
            self.mouse_pressed = False  # set flag to indicate left button is released
            event.accept()

    def mouseMoveEvent(self, event):
        if self.mouse_pressed:  # check if left mouse button is pressed
            self.parent().move(event.globalPos() - self.mouse_position)  # move parent widget according to mouse position
            event.accept()



#_  _ ____ _ _  _    _ _ _ _ _  _ ___  ____ _ _ _ 
#|\/| |__| | |\ |    | | | | |\ | |  \ |  | | | | 
#|  | |  | | | \|    |_|_| | | \| |__/ |__| |_|_| 
                                                 


class cypunk1Window(QMainWindow):
    resized = pyqtSignal()  # Ajoutez cette ligne

    def __init__(self, title, window_size, btn_minimize=None, btn_show=None, stylesheet_path=None):
        super().__init__()
        self.mwgui(title, window_size, btn_minimize, btn_show, stylesheet_path)



    # Graphical user interface of main window
    def mwgui(self, title, window_size, btn_minimize, btn_show, stylesheet_path):
        self.title = title  # initialize window title in a variable that can be used in another page
        self.btn_minimize = btn_minimize  
        self.btn_show = btn_show  

        # Set Layout for the title (you can add self.vlay_cypunk1.addWidget(YOUR_WIDGET) directly in other pages  )
        self.init_Vlayout()



        #Load stylesheet if available
        if stylesheet_path:
            with open(stylesheet_path, "r") as file:
                stylesheet = file.read()
                self.setStyleSheet(stylesheet)  # set stylesheet for the window


        self.minimize_icon = QIcon(btn_minimize)
        self.show_icon = QIcon(btn_show)

        width, height = map(int, window_size.split("x"))  # parse window size from string



        self.setWindowFlags(Qt.WindowStaysOnTopHint | Qt.FramelessWindowHint)  # set window flags
        self.setAttribute(Qt.WA_NoSystemBackground, True)  # set widget attribute for no system background
        self.setAttribute(Qt.WA_TranslucentBackground, True)  # set widget attribute for translucent background



        self.central_widget = QFrame()  # create a central widget to let set the rgba(transparency) in your other page
        self.setMinimumSize(width, height)  # set minimum size for the window (updated line)
        self.setCentralWidget(self.central_widget)




        # create title bar widget
        self.title_bar = cypunkTitle1(self)  
        self.title_bar.setGeometry(0, 0, self.width(), 30)  # set geometry for title bar widget

        self.hide_button = QPushButton(self.title_bar)  # create minimize button

        #Use this to minimize the window with an image
        if btn_minimize:
            self.hide_button.setIcon(QIcon(btn_minimize)) 


        self.hide_button.setGeometry(0, 5, 30, 20) 
        self.hide_button.setStyleSheet("background-color: transparent;") 
        self.hide_button.clicked.connect(self.toggle_window) 

        self.title_label = QLabel(title, self.title_bar, objectName="title")  # create title label you can reuse in css
        self.title_label.setGeometry(28, 5, 200, 20)  
        self.title_label.setStyleSheet("background-color: transparent; padding-right: 20px;")




        # The close button inside the window
        self.close_button = QPushButton(self.title_bar)  # create close button
        self.close_button.setGeometry(width - 30 - 8, 15, 20, 20)  # Place it 8 px before the hexagonal mask
        self.close_button.setStyleSheet("QPushButton {"
                                         "background-color: red;"
                                         "border: none;"
                                         "width: 20px;"
                                         "height: 10px;"
                                         "}"
                                         "QPushButton:hover {"
                                         "background-color: darkred;"
                                         "}")
        self.close_button.clicked.connect(self.close_application)


        # The close button inside the window
        self.micromize_button = QPushButton(self.title_bar)  # create close button
        self.micromize_button.setGeometry(width - 60 - 8, 5, 20, 20)  # Place it 8 px before the hexagonal mask
        self.micromize_button.setStyleSheet("QPushButton {"
                                         "background-color: orange;"
                                         "border: none;"
                                         "width: 20px;"
                                         "height: 10px;"
                                         "}"
                                         "QPushButton:hover {"
                                         "background-color: darkorange;"
                                         "}")
        self.micromize_button.clicked.connect(self.showMinimized)




        # Element to resize window by dragging the right corner
        self.resizeGrip = SizeGrip(self)
        self.resizeGrip.setGeometry(self.width() - 10, self.height() - 10, 10, 10)
        self.resizeGrip.lower()

        # Add size grip
        self.size_grip = QSizeGrip(self.central_widget)
        self.size_grip.setGeometry(self.width() - 20, self.height() - 20, 20, 20)

        # Ajoutez ces lignes à la fin de la méthode mwgui
        self.resized.connect(self.update_central_widget_geometry)
        self.update_central_widget_geometry()







    def update_central_widget_geometry(self):
        self.central_widget.setGeometry(0, 0, self.width(), self.height())



    def resizeEvent(self, event):
        super().resizeEvent(event)
        self.resized.emit()  # Ajoutez cette ligne

        self.resizeGrip.setGeometry(self.width() - 10, self.height() - 10, 10, 10)
        self.size_grip.setGeometry(self.width() - 20, self.height() - 20, 20, 20)
        self.set_hexagon_shape()

        # move the close button widget with the window
        new_pos = self.mapToGlobal(QPoint(self.width() - 30, 5))
        # Adjust the position of the close button
        self.micromize_button.move(self.width() - 60 - 8, 5)
        self.close_button.move(self.width() - 30 - 8, 5)
        self.title_bar.setGeometry(0, 0, self.width(), 30)  # set geometry for title bar widget
        self.central_widget.setGeometry(0, 0, self.width(), self.height())  # update central widget geometry
        self.set_hexagon_shape()  # update hexagon shape
        self.frameGeometry().setWidth(self.width())  # update frame geometry width
        self.frameGeometry().setHeight(self.height())  # update frame geometry height








    def init_Vlayout(self):
        # Apply a vertical layout to the central widget
        self.vlay_cypunk1 = QVBoxLayout(self.centralWidget())
        self.vlay_cypunk1.setContentsMargins(0, 30, 0, 0)


    def Vlayout(self, widget):
        # Add the given widget to the layout
        self.vlay_cypunk1.addWidget(widget)


    def moveEvent(self, event):
        super().moveEvent(event)
        new_pos = self.mapToGlobal(QPoint(self.width() - 10, 0))





    def set_hexagon_shape(self):
        # create QPainterPath for a hexagon shape
        path = QPainterPath()
        path.moveTo(30, 0)
        path.lineTo(self.width() - 20, 0)
        path.lineTo(self.width(), 20)
        path.lineTo(self.width(), self.height() - 0)
        path.lineTo(self.width() - 20, self.height())
        path.lineTo(20, self.height())
        path.lineTo(0, self.height() - 20)
        path.lineTo(0, 0)
        path.closeSubpath()

        # create QRegion from hexagon shape and set it as the mask for the window
        region = QRegion(path.toFillPolygon().toPolygon())
        self.setMask(region)




    def toggle_window(self):
        if self.central_widget.isVisible():  # check if central widget is visible
            # hide central widget, title label, and close button widget
            self.central_widget.hide()
            self.title_label.hide()
            self.close_button.hide()
            self.hide_button.setIcon(self.show_icon)  # set icon for minimize button to show icon

        else:
            # show central widget, title label, and close button widget
            self.close_button.show()
            self.central_widget.show()
            self.title_label.show()
            self.hide_button.setIcon(self.minimize_icon)  # set icon for minimize button to minimize icon





    def close_application(self):
        self.close()  # close the application window, so it has to be used in main window.




#_  _ ____ ____ ____ ____ ____ ____    ___  ____ _  _ 
#|\/| |___ [__  [__  |__| | __ |___    |__] |  |  \/  
#|  | |___ ___] ___] |  | |__] |___    |__] |__| _/\_ 
                              
                                                     
class Cypunk1MessageBox(QMessageBox):
    def __init__(self,stylesheet_path=None, *args, **kwargs): # pass stylesheet as argument
        super().__init__(*args, **kwargs)

        self.mbGui(stylesheet_path)  


    def mbGui(self,stylesheet_path):
        #Load stylesheet if available
        if stylesheet_path:
            with open(stylesheet_path, "r") as file:
                stylesheet = file.read()
                self.setStyleSheet(stylesheet)  
     
     
        self.setWindowFlags(Qt.WindowStaysOnTopHint | Qt.FramelessWindowHint)  # set window flags
        self.setAttribute(Qt.WA_NoSystemBackground, True)  # set widget attribute for no system background
        self.setAttribute(Qt.WA_TranslucentBackground, True)  # set widget attribute for translucent background
   


    # This function is similar to the Hexagon function you saw before, but
    # here you can also assign and use colours for the message box
    def paintEvent(self, event):
        # Create a QPainter object to paint on the widget
        painter = QPainter(self)

        # Set the brush color to the background color of the widget
        painter.setBrush(self.palette().brush(QPalette.Background))

        # Create a QPainterPath object to define the shape of the widget
        path = QPainterPath()
        path.moveTo(30, 0)
        path.lineTo(self.width() - 20, 0)
        path.lineTo(self.width(), 20)
        path.lineTo(self.width(), self.height() - 0)
        path.lineTo(self.width() - 20, self.height())
        path.lineTo(20, self.height())
        path.lineTo(0, self.height() - 20)
        path.lineTo(0, 0)

        # Close the subpath to complete the shape
        path.closeSubpath()

        # Draw the shape using the QPainter object
        painter.drawPath(path)




#Functions to move the window by holding left mouse button
    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.dragPosition = event.globalPos() - self.frameGeometry().topLeft()
            event.accept()

    def mouseMoveEvent(self, event):
        if event.buttons() == Qt.LeftButton:
            self.move(event.globalPos() - self.dragPosition)
            event.accept()



